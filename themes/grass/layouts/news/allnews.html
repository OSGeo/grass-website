{{/*  themes/grass/layouts/news/allnews.html  */}}
{{ partial "head.html" . }}

{{ "<!-- navigation -->" | safeHTML }}
<header class="shadow-bottom bg-primary">
  <div class="fixed-top">
    {{ partial "banner.html" . }}
    <div class="bg-primary">
      <div class="container bg-primary">
        {{ partial "navigation.html" . }}
      </div>
    </div>
  </div>
</header>
{{ "<!-- /navigation -->" | safeHTML }}

<section class="pt-4 bg-gray" style="margin-top:95px;">

  <div class="container">
    <div class="row">
      <div class="col-12 text-center">
        <h2 class="section-title">News from the GRASS world</h2>
      </div>
    </div>
  </div>

  <div class="container mt-4">
    <div class="row">

      <!-- MAIN COLUMN -->
      <div class="col-lg-8">
        <div id="news" class="p-5 bg-white">
          <h2 class="page-title">{{ .Title }}</h2>

          {{/* Collect unique years */}}
          {{ $allYears := slice }}
          {{ range where $.Site.Pages "Section" "news" }}
            {{ if .Date }}
              {{ $allYears = $allYears | append (.Date.Format "2006") }}
            {{ end }}
          {{ end }}

          {{ $uniqueYears := slice }}
          {{ range $allYears }}
            {{ if not (in $uniqueYears .) }}
              {{ $uniqueYears = $uniqueYears | append . }}
            {{ end }}
          {{ end }}

          {{ $uniqueYears = sort $uniqueYears "value" "desc" }}
          {{ $currentYear := now.Format "2006" }}

          <!-- LOOP YEARS -->
          {{ range $year := $uniqueYears }}
            {{ $collapseID := printf "news-%s" $year }}

            <div class="mb-4">

              <!-- YEAR TITLE WITH ICON -->
              <a class="d-block h3 text-dark text-decoration-none"
                 data-toggle="collapse"
                 href="#{{ $collapseID }}"
                 role="button"
                 aria-controls="{{ $collapseID }}"
                 aria-expanded="{{ if eq $year $currentYear }}true{{ else }}false{{ end }}">
                 <i class="fa-solid fa-chevron-right me-2 p-2"></i>{{ $year }}
              </a>

              <!-- POSTS -->
              <div id="{{ $collapseID }}"
                   class="collapse {{ if eq $year $currentYear }}show{{ end }}">

                <ul class="list-unstyled mt-3">
                  {{ range sort (where $.Site.Pages "Section" "news") "Date" "desc" }}
                    {{ if and .Date (eq (.Date.Format "2006") $year) }}
                      <li class="mb-4">
                        <h3 class="entry-title h5 mb-1">
                          <a href="{{ .RelPermalink }}" class="nws">{{ .Title }}</a>
                        </h3>
                        <div class="entry-meta text-muted small">
                          <i class="fa fa-calendar"></i>
                          {{ .Date.Format "January 02, 2006" }}
                        </div>
                      </li>
                    {{ end }}
                  {{ end }}
                </ul>

              </div>
            </div>

          {{ end }}

        </div>
      </div>

      <!-- SIDEBAR -->
      <div class="col-lg-4 bg-white">

        <div class="mb-4">
          <h3 class="mt-20 grasscolor">@GRASSGIS on Mastodon</h3>
          {{ partial "mastodon.html" . }}
        </div>

        <div class="mb-4">
          <h3 class="mt-20 grasscolor">@GRASSGIS on X</h3>
          {{ partial "twitter.html" . }}
        </div>

        <div>
          <h3 class="mt-20 grasscolor">Next events</h3>

          {{ $events := where (where $.Site.Pages "Section" "events") ".Params.event.start" "!=" nil }}
          {{ range first 3 (sort $events ".Params.event.start" "asc") }}
            {{ if (time .Params.event.start).After now }}
              <div class="mb-3">
                <div class="row align-items-center">
                  <div class="col-4">
                    <img src="{{ .Site.BaseURL }}{{ .Params.logo }}" class="eventslogo img-fluid" alt="{{ .Title }}">
                  </div>
                  <div class="col-8">
                    <h4 class="h6 mb-1">
                      <a href="{{ .Params.website }}" target="_blank" rel="noopener" class="nws">
                        {{ .Title }}
                      </a>
                    </h4>
                    <p class="mb-0 small text-muted">
                      {{ .Params.where }}<br>
                      {{ .Params.event.start }} â€“ {{ .Params.event.end }}
                    </p>
                  </div>
                </div>
              </div>
            {{ end }}
          {{ end }}

        </div>

    </div>
  </div>

</section>

{{ partial "footer.html" . }}
